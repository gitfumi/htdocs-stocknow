extends /_pug/_inc/_layout

//-
	---------------------------------------------------------
	ページ固有の変数を定義
	---------------------------------------------------------
append setVar
	- layout = 'entry'
	- pageUrl = '/entry/butterbutler.html'
	- dirArray = createDirArray(pageUrl)
	- bodyAttributes.id = 'p-entry'
	- bodyAttributes.class = 'p-butterbutler'

//-
	---------------------------------------------------------
	ページ固有のCSSを読み込み
	---------------------------------------------------------
append css
	link(rel="stylesheet" href="/css/p_entry.css")

//-
	---------------------------------------------------------
	コンテンツ
	---------------------------------------------------------
block main

	article.main_inner

		header.entry_header
			div.mainvisual
				p.mainvisual_pic: img(src="/cms/item/img/pic_butterbutler_01.png" alt="")
				p.mainvisual_date 2019.00.00
				h1.mainvisual_ttl: span バターが主役の洋菓子！<br>バターバトラーのバターフィナンシェ
			ul.c-tag_list
				li: a(href="/") #[span タグ1]
				li: a(href="/") #[span タグあああああ]
				li: a(href="/") #[span タグ3]
				li: a(href="/") #[span タグｆｆｆ]
				li: a(href="/") #[span タグ5]
				li: a(href="/") #[span タグ6]
				li: a(href="/") #[span タグ3]
				li: a(href="/") #[span タグｆｆｆ]
				li: a(href="/") #[span タグ5]
				li: a(href="/") #[span タグ6]

		div.c-advertise: a(href="/"): img(src="https://placehold.it/728x90" alt="")

		div.entry_content
			div.mokuji
				p.m-titleType03 目次
				ul.mokuji_list
					li: a(href="#anchor01") ワンランク上の手土産に最適！濃厚バターフィナンシェ
					li: a(href="#anchor02") バターバトラーの店舗情報
					li: a(href="#anchor03") バターバトラーの催事場・期間限定の販売店情報
					li: a(href="#anchor04") バターガレットとバターシュガーケーキ

			section.entry_section#anchor01
				h2.m-titleType02 ワンランク上の手土産に最適！濃厚バターフィナンシェ
				div.entry_pic.m-bySide.is-2block
					div: img(src="/cms/item/img/pic_butterbutler_sub01.jpg" alt="")
					div: img(src="/cms/item/img/pic_butterbutler_sub02.jpg" alt="")
				p.entry_txt Butter Butler(バター バトラー）はその名の通り、バターにこだわったスイーツ店。<br>みんなが贈りたい。JR 東⽇本おみやげグランプリで見事グランプリを獲得！<br>表面をカリッと焼き上げたフィナンシェには、スイス産の発酵バターとフランス産のゲランドの塩を使用。<br>メープルシロップを染み込ませ、中はしっとり。一度食べたら忘れらないはずです！

			section.entry_section#anchor02
				h2.m-titleType02 バターバトラーの店舗情報
				p.entry_txt 今のところ店舗は新宿駅だけになります。場所はニューマン2階の駅中のスイーツエリア内にあるので、電車で乗り換えする際に購入することができます。<br>一番近い改札は甲州街道改札、新南改札、ミライナタワー改札。待ち時間はなく並んでいても3-5分程度で購入できると思います。
				div.entry_mapIframe: iframe(src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3240.532522244609!2d139.69885701525894!3d35.68851108019259!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188cdaa2f26eed%3A0x210ebb2601e0efbe!2z44OQ44K_44O844OQ44OI44Op44O8!5e0!3m2!1sja!2sjp!4v1542194563786" width="1020" height="500" allowfullscreen)
				div.entry_shop
					div.m-bySide.is-2block.shop_list
						section
							h4.shop_name JR新宿駅構内 NEWoMan SHINJUKU 2F エキナカ
							p.shop_pin 〒151-0051 東京都渋谷区千駄ヶ谷5-24-55　JR新宿駅構内 NEWoMan SHINJUKU 2F エキナカ
							p.shop_time 8:00 ~ 22:00　※土日祝日 8:00 ~ 21:30
						div
							p 新南改札 ミライナタワー改札 付近<br>※駅構外からお越しの方は #[span.butterbutler_att JRの入場券] が必要です
				p.entry_txt 新宿駅以外の取り扱い店舗は海老名SAになり、東名高速道路「海老名SA」下りショッピングコーナーで購入できます。

			section.entry_section#anchor03
				h2.m-titleType02 バターバトラーの催事場・期間限定の販売店情報
				section.entry_shop
					h3.m-titleType04.shop_head #[span 2月] の期間限定 出店情報
					div.m-bySide.is-3block.shop_list.js-shop_list
						section
							h4.shop_name.js-shop_name JR名古屋タカシマ屋
							p.shop_pin.js-shop_pin 愛知県名古屋市名駅1-1-4 <br>1Fクラブハリエ前
							p.shop_date 2019/1/18～2019/2/5
							p.shop_time 10:00～20:00
							p.shop_item バターフィナンシェ4・8・12・16入<br>バターガレット9・18入<br>バターキャラメルポット
						section
							h4.shop_name.js-shop_name 羽田空港第2ターミナル　スマイルトーキョー
							p.shop_pin.js-shop_pin 東京都大田区羽田空港3-4-2 <br>羽田空港第二ターミナル2F <br>スマイルトーキョー内
							p.shop_date 2018/9/1～
							p.shop_time 5:45～20:30
							p.shop_item バターフィナンシェ4・8・12・16入<br>バターガレット9・18入<br>キャラメルポット
						section
							h4.shop_name.js-shop_name ルミネ立川店
							p.shop_pin.js-shop_pin 東京都立川市曙町2-1-1 <br>ルミネ立川店1F スイーツゾーン
							p.shop_date 2018/11/1～
							p.shop_time 平日；10:00~21:00<br>土日祝；10:00~20:30
							p.shop_item バターフィナンシェ4・8・12・16入<br>バターガレット9・18入<br>キャラメルポット<br>バターシュガーケーキ
				//- div#js-googleMap(style="width:600px; height:300px")
				p.entry_att 上記の催事場以外でも東京駅、品川駅などでも開催している場合もあるので、SNSなどでチェックしてみてください！


			section.entry_section#anchor04
				h2.m-titleType02 バターガレットとバターシュガーケーキ
				div.m-bySide.is-2block
					section
						p.entry_pic: img(src="/cms/item/img/pic_butterbutler_sub03.jpg" alt="")
						h3.butterbutler_txt #[span #[em THE BUTTER GALETTE] [バターガレット]]<br>フランス産発酵バター、ゲランド塩を使ったガレット。サクッ ホロッと口の中でほどける食感が特徴のフランス伝統菓子です。
					section
						p.entry_pic: img(src="/cms/item/img/pic_butterbutler_sub04.jpg" alt="")
						h3.butterbutler_txt #[span #[em THE BUTTER SUGER CAKE] [バターシュガーケーキ]]<br>北海道産バターを贅沢に使った、バターの風味たっぷりのバターケーキ。表面のザラメのシャリシャリとした食感のおかげで、最後まで飽きずに食べ進められます。

			div#fb-root
			script(async defer src="https://connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v3.2&appId=588513644498847&autoLogAppEvents=1")
			div.entry_facebook
				div.fb-page(data-href="https://www.facebook.com/butterbutler.jp/" data-tabs="timeline" data-width="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false")
					blockquote.fb-xfbml-parse-ignore(cite="https://www.facebook.com/butterbutler.jp/"): a(href="https://www.facebook.com/butterbutler.jp/") ButterButler

		aside.entry_social
			ul.social_list
				li.is-facebook: a(href="http://www.facebook.com/share.php?u=https://stocknow.info/" onclick="window.open(encodeURI(decodeURI(this.href)), 'FBwindow', 'width=554, height=470, menubar=no, toolbar=no, scrollbars=yes'); return false;" rel="nofollow"): span シェア
				li.is-twitter: a(target="_blank" href="https://twitter.com/share"): span twitter
				li.is-line: a(href="https://plus.line.com/share?url=https://stocknow.info/" onclick="window.open(this.href, 'Gwindow', 'width=650, height=450, menubar=no, toolbar=no, scrollbars=yes'); return false;"): span line
				li.is-hatenabookmark: a(href="https://plus.line.com/share?url=https://stocknow.info/" onclick="window.open(this.href, 'Gwindow', 'width=650, height=450, menubar=no, toolbar=no, scrollbars=yes'); return false;"): span はてなブログ

		section.entry_relation
			h2.m-titleType03 関連記事
			div.c-item_list.is-3block.relation_list
				div
					a(href="/entry/butterbutler.html")
						p.c-item_listPic: img(src="/cms/item/img/pic_butterbutler_01.png" alt="")
						p.c-item_listDate 2019.00.00
						p.c-item_listTxt バターが主役の洋菓子！バターバトラーのバターフィナンシェ
					ul.c-tag_list
						li: a(href="/") #[span タグ1]
						li: a(href="/") #[span タグあああああ]
						li: a(href="/") #[span タグ3]
						li: a(href="/") #[span タグｆｆｆ]
						li: a(href="/") #[span タグ5]
						li: a(href="/") #[span タグ6]
						li: a(href="/") #[span タグ3]
						li: a(href="/") #[span タグｆｆｆ]
						li: a(href="/") #[span タグ5]
						li: a(href="/") #[span タグ6]
				div
					a(href="/entry/bake.html")
						p.c-item_listPic: img(src="/cms/item/img/pic_bake_01.jpg" alt="")
						p.c-item_listDate 2019.00.00
						p.c-item_listTxt カフェ併設の店舗は全国でたった1店舗！自由が丘のチーズタルト専門店『BAKE CHEESE TART』
					ul.c-tag_list
						li: a(href="/") #[span タグ1]
						li: a(href="/") #[span タグあああああ]
				div
					a(href="/entry/zakuzaku.html")
						p.c-item_listPic: img(src="/cms/item/img/pic_zakuzaku_01.jpg" alt="")
						p.c-item_listDate 2019.00.00
						p.c-item_listTxt ほげほげほげほげほげほげほげほげほげほげほげほげほげほげ
					ul.c-tag_list
						li: a(href="/") #[span タグ1]
						li: a(href="/") #[span タグあああああ]

		div.c-advertise: a(href="/"): img(src="https://placehold.it/728x90" alt="")

append script
	script(src="//maps.googleapis.com/maps/api/js?key=AIzaSyD29DdDt14xcI-AuwSD8ZAHlKt6OKySBzc")
	script.
		let $list = $('.js-shop_list section'),
		shopList = [];
		// ショップリストの取得
		for (let i = 0; i < $list.length; i++) {
			shopList[i] = [];
			shopList[i].shopname = $list.eq(i).find('.js-shop_name').text();
			shopList[i].address = $list.eq(i).find('.js-shop_pin').text();
		}
		let shopCode = [];
		let shopHoge = [];
		// ショップリストの緯度経度を取得
		function dfdGeocode(){
			let addressJP,shopName;
			let dfd = $.Deferred();
			// Geocoderのインスタンスを生成
			let geocoder = new google.maps.Geocoder();
			// カウンター
			let cnt = 0;
			// 店舗数分マップに埋め込み
			$.each(shopList, function(index, val){
				addressJP = val.address;
				shopName  = val.shopname;
				shopHoge.push({
					shp : shopName,
					add : addressJP
				});
				geocoder.geocode({
					'address': addressJP //ショップ
				}, function(results, status, callback) { // 結果
					if (status === google.maps.GeocoderStatus.OK) {
						shopCode.push({
							lat : results[0].geometry.location.lat(),	//緯度
							lng : results[0].geometry.location.lng()	//経度
						});
						if(cnt == shopList.length -1){
							dfd.resolve();
						}
						cnt++;
						callback();
					}else { // 失敗した場合
						alert(status);
					}
				});
				
			});
			return dfd.promise();
		}
		// 非同期処理を並列化
		$.when(
			dfdGeocode()
		).done(function(position){
			//- console.log(shopCode);
			//- console.log(shopHoge);
			let map;
			let googleMap = function(){
				$.each(shopList, function(index, val){
					//- console.log(index + ' :   ' + shopList[index].shopname + ' :   ' + shopCode[index].lat);
					if(index == 0){
						let myOptions = {
							zoom: 18, /*拡大比率*/
							center: shopCode[index], /*表示枠内の中心点*/
							mapTypeControlOptions: { mapTypeIds: ['sample', google.maps.MapTypeId.ROADMAP] }
						};
						map = new google.maps.Map(document.getElementById('js-googleMap_'), myOptions);
						/*取得スタイルの貼り付け*/
						let styleOptions = [
							{
								'stylers': [
									{ 'saturation': -100 },
									{ 'visibility': 'simplified' },
									{ 'lightness': 22 }
								]
							}
						];
						let styledMapOptions = { name: 'STOCKNOW仕様' }
						let sampleType = new google.maps.StyledMapType(styleOptions, styledMapOptions);
						map.mapTypes.set('sample', sampleType);
						map.setMapTypeId('sample');
					}
					// googleMapを書き込む
					markup(shopCode[index],val.shopname,map);
				});
			}
			google.maps.event.addDomListener(window, 'load', googleMap);

			$('.shopList li .shopMapActive').on('click',function(){
				let eq = $(this).parents('li').index();
				console.log(eq);
				map.panTo(new google.maps.LatLng(shopCode[eq]));
			})
		})
		function markup(LATLNG, SHOPNAME, MAP){
			/*アイコン設定▼*/
			let icon = {
				url: '/img/cmn/icon_googlemap.png',
				scaledSize : new google.maps.Size(51.5,65.5)
			}
			let markerOptions = {
				position: LATLNG,
				map: MAP,
				icon: icon,
				title: SHOPNAME
			};
			let marker = new google.maps.Marker(markerOptions);
		}